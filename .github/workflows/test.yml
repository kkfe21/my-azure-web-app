name: Custom Commands
on:
    issue_comment:
        types:
            [
                created,
            ]

jobs:
    slash_commands:
        if: github.event.issue.pull_request
        runs-on: ubuntu-latest
        permissions:
            issues: write
            pull-requests: write
            contents: read
        steps:
            - name: Handle slash commands
              uses: actions/github-script@v7
              with:
                  script:
                      |
                      const comment = context.payload.comment.body.trim();
                      const issueNumber = context.issue.number;
                      const commenter = context.payload.comment.user.login;
                      const prAuthor = context.payload.issue.user.login;

                      // ê³µí†µ ë°˜ì‘ í•¨ìˆ˜
                      async function addReaction(content) {
                        await github.rest.reactions.createForIssueComment({
                          owner: context.repo.owner,
                          repo: context.repo.repo,
                          comment_id: context.payload.comment.id,
                          content: content
                        });
                      }

                      // ê³µí†µ ëŒ“ê¸€ í•¨ìˆ˜
                      async function addComment(body) {
                        await github.rest.issues.createComment({
                          owner: context.repo.owner,
                          repo: context.repo.repo,
                          issue_number: issueNumber,
                          body: body
                        });
                      }

                      // /lgtm ëª…ë ¹ì–´ - ìë™ ìŠ¹ì¸ í¬í•¨
                      if (comment === '/lgtm' || comment.startsWith('/lgtm ')) {
                        await addReaction('+1');
                        const message = comment.length > 5 ? comment.substring(6) : '';
                        
                        // ë³¸ì¸ PRì€ ìŠ¹ì¸í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ ì²´í¬
                        if (commenter === prAuthor) {
                          await addComment('âš ï¸ **ìì‹ ì˜ PRì€ ìŠ¹ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤**\n\në‹¤ë¥¸ íŒ€ì›ì˜ ë¦¬ë·°ë¥¼ ë°›ì•„ì£¼ì„¸ìš”! ğŸ™');
                          return;
                        }
                        
                        try {
                          // PR ë¦¬ë·°ë¡œ ìŠ¹ì¸ ìƒì„±
                          await github.rest.pulls.createReview({
                            owner: context.repo.owner,
                            repo: context.repo.repo,
                            pull_number: issueNumber,
                            event: 'APPROVE',
                            body: 'âœ… **LGTM!** Looks Good To Me ğŸ‘\n\nApproved by @' + commenter + (message ? '\n\n**Comment:** ' + message : '')
                          });
                          
                          // ì„±ê³µ ì•Œë¦¼ ëŒ“ê¸€
                          await addComment('ğŸš€ **ìë™ ìŠ¹ì¸ ì™„ë£Œ!**\n\nâœ… PRì´ @' + commenter + 'ì— ì˜í•´ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.' + (message ? '\n\n**ì½”ë©˜íŠ¸:** ' + message : '') + '\n\në¨¸ì§€ ì¤€ë¹„ ì™„ë£Œ! ğŸ‰');
                          
                        } catch (error) {
                          // ìŠ¹ì¸ ì‹¤íŒ¨ì‹œ (ì´ë¯¸ ìŠ¹ì¸í–ˆê±°ë‚˜ ê¶Œí•œ ì—†ìŒ ë“±)
                          console.log('Review creation failed:', error);
                          await addComment('âœ… **LGTM!** Looks Good To Me ğŸ‘\n\nApproved by @' + commenter + (message ? '\n\n**Comment:** ' + message : '') + '\n\n*Note: ìë™ ìŠ¹ì¸ì€ ì‹¤íŒ¨í–ˆì§€ë§Œ LGTMì€ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.*');
                        }
                      }

